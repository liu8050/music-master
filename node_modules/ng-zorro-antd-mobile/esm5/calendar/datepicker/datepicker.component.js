/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, HostBinding, ViewEncapsulation, Input, ElementRef, ViewChild } from '@angular/core';
import { CalendarDatePickerBaseComponent } from './datepicker.base.component';
var CalendarDatePickerComponent = /** @class */ (function (_super) {
    tslib_1.__extends(CalendarDatePickerComponent, _super);
    function CalendarDatePickerComponent() {
        var _this = _super.call(this) || this;
        _this.transform = '';
        _this._initDelta = 0;
        _this._lastY = 0;
        _this._delta = _this._initDelta;
        _this.amCalendar = true;
        _this.datePicker = true;
        _this.genMonthComponent = (/**
         * @param {?=} data
         * @return {?}
         */
        function (data) {
            if (!data)
                return;
            return {
                monthData: data,
                locale: _this.props.locale,
                rowSize: _this.props.rowSize,
                onCellClick: _this.baseOnCellClick,
                getDateExtra: _this.props.getDateExtra,
                ref: (/**
                 * @param {?} dom
                 * @return {?}
                 */
                function (dom) {
                    data.componentRef = dom || data.componentRef || undefined;
                    data.updateLayout = (/**
                     * @return {?}
                     */
                    function () {
                        _this.computeHeight(data, dom);
                    });
                    data.updateLayout();
                })
            };
        });
        _this.computeHeight = (/**
         * @param {?} data
         * @param {?} singleMonth
         * @return {?}
         */
        function (data, singleMonth) {
            if (singleMonth && singleMonth.wrapperDivDOM) {
                if (!data.height && !singleMonth.wrapperDivDOM.clientHeight) {
                    setTimeout((/**
                     * @return {?}
                     */
                    function () { return _this.computeHeight(data, singleMonth); }), 500);
                    return;
                }
                data.height = singleMonth.wrapperDivDOM.clientHeight || data.height || 0;
                data.y = singleMonth.wrapperDivDOM.offsetTop || data.y || 0;
            }
        });
        _this.setLayout = (/**
         * @param {?} dom
         * @return {?}
         */
        function (dom) {
            if (dom) {
                var onLayout = _this.props.onLayout;
                onLayout && onLayout(dom.clientHeight);
                /** @type {?} */
                var scrollHandler_1 = _this.createOnScroll();
                dom.onscroll = (/**
                 * @param {?} evt
                 * @return {?}
                 */
                function (evt) {
                    scrollHandler_1({
                        client: dom.clientHeight,
                        full: ((/** @type {?} */ (evt.currentTarget))).clientHeight,
                        top: ((/** @type {?} */ (evt.currentTarget))).scrollTop
                    });
                });
            }
        });
        _this.setPanel = (/**
         * @param {?} dom
         * @return {?}
         */
        function (dom) {
            _this._panel = dom;
        });
        return _this;
    }
    Object.defineProperty(CalendarDatePickerComponent.prototype, "onCellClick", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.props.onCellClick = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarDatePickerComponent.prototype, "endDate", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            /** @type {?} */
            var oldProps = Object.assign({}, this.props);
            this.props.endDate = value;
            this.receiveProps(oldProps, this.props);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarDatePickerComponent.prototype, "startDate", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            /** @type {?} */
            var oldProps = Object.assign({}, this.props);
            this.props.startDate = value;
            this.receiveProps(oldProps, this.props);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarDatePickerComponent.prototype, "propsData", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.props = tslib_1.__assign({}, this.props, value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarDatePickerComponent.prototype, "onSelectHasDisableDate", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.props.onSelectHasDisableDate = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarDatePickerComponent.prototype, "onLayout", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.props.onLayout = value;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} event
     * @return {?}
     */
    CalendarDatePickerComponent.prototype.onTouchStart = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this._lastY = event.touches[0].screenY || event.touches[0].pageY;
        this._delta = this._initDelta;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    CalendarDatePickerComponent.prototype.onTouchMove = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var ele = event.currentTarget;
        /** @type {?} */
        var isReachTop = ele.scrollTop === 0;
        if (isReachTop) {
            this._delta = (event.touches[0].screenY || event.touches[0].pageY) - this._lastY;
            if (this._delta > 0) {
                event.preventDefault();
                if (this._delta > 80) {
                    this._delta = 80;
                }
            }
            else {
                this._delta = 0;
            }
            this.setTransform(this._panel.style, "translate3d(0," + this._delta + "px,0)");
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    CalendarDatePickerComponent.prototype.onTouchEnd = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.onFinish();
    };
    /**
     * @return {?}
     */
    CalendarDatePickerComponent.prototype.onFinish = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this._delta > 40 && this.canLoadPrev()) {
            this.genMonthData(this.state.months[0].firstDate, -1);
            this.visibleMonth = this.state.months.slice(0, this.props.initalMonths);
            this.state.months.forEach((/**
             * @param {?} m
             * @return {?}
             */
            function (m) {
                m.updateLayout && m.updateLayout();
            }));
        }
        this.setTransform(this._panel.style, "translate3d(0,0,0)");
        this.setTransition(this._panel.style, '.3s');
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this._panel && _this.setTransition(_this._panel.style, '');
        }), 300);
    };
    /**
     * @param {?} nodeStyle
     * @param {?} value
     * @return {?}
     */
    CalendarDatePickerComponent.prototype.setTransform = /**
     * @param {?} nodeStyle
     * @param {?} value
     * @return {?}
     */
    function (nodeStyle, value) {
        this.transform = value;
        nodeStyle.transform = value;
        nodeStyle.webkitTransform = value;
    };
    /**
     * @param {?} nodeStyle
     * @param {?} value
     * @return {?}
     */
    CalendarDatePickerComponent.prototype.setTransition = /**
     * @param {?} nodeStyle
     * @param {?} value
     * @return {?}
     */
    function (nodeStyle, value) {
        nodeStyle.transition = value;
        nodeStyle.webkitTransition = value;
    };
    /**
     * @return {?}
     */
    CalendarDatePickerComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.init();
        this.setLayout(this.layoutDom.nativeElement);
        this.setPanel(this.panelDom.nativeElement);
    };
    CalendarDatePickerComponent.decorators = [
        { type: Component, args: [{
                    selector: 'CalendarDatePicker, nzm-calendar-date-picker',
                    template: "<CalendarWeekPanel [locale]=\"props.locale\"></CalendarWeekPanel>\n<div #layout\n     class=\"wrapper\"\n     style=\"overflow-x:hidden;overflow-y:visible;-webkit-overflow-scrolling:touch;\"\n     (touchstart)=\"onTouchStart($event)\"\n     (touchmove)=\"onTouchMove($event)\"\n     (touchend)=\"onTouchEnd($event)\"\n>\n  <div #panel [ngStyle]=\"{transform: transform}\">\n    <div *ngIf=\"canLoadPrev()\" class=\"load-tip\">{{props.locale.loadPrevMonth}}</div>\n    <div class=\"months\">\n      <CalendarSingleMonth *ngFor=\"let item of visibleMonth;let i = index;\"\n                   style=\"display: block;\"\n                   [data]=\"item.component\"\n      ></CalendarSingleMonth>\n    </div>\n  </div>\n</div>\n",
                    encapsulation: ViewEncapsulation.None
                }] }
    ];
    /** @nocollapse */
    CalendarDatePickerComponent.ctorParameters = function () { return []; };
    CalendarDatePickerComponent.propDecorators = {
        layoutDom: [{ type: ViewChild, args: ['layout',] }],
        panelDom: [{ type: ViewChild, args: ['panel',] }],
        onCellClick: [{ type: Input }],
        endDate: [{ type: Input }],
        startDate: [{ type: Input }],
        propsData: [{ type: Input }],
        onSelectHasDisableDate: [{ type: Input }],
        onLayout: [{ type: Input }],
        amCalendar: [{ type: HostBinding, args: ['class.am-calendar',] }],
        datePicker: [{ type: HostBinding, args: ['class.date-picker',] }]
    };
    return CalendarDatePickerComponent;
}(CalendarDatePickerBaseComponent));
export { CalendarDatePickerComponent };
if (false) {
    /** @type {?} */
    CalendarDatePickerComponent.prototype.transform;
    /**
     * @type {?}
     * @private
     */
    CalendarDatePickerComponent.prototype._panel;
    /**
     * @type {?}
     * @private
     */
    CalendarDatePickerComponent.prototype._initDelta;
    /**
     * @type {?}
     * @private
     */
    CalendarDatePickerComponent.prototype._lastY;
    /**
     * @type {?}
     * @private
     */
    CalendarDatePickerComponent.prototype._delta;
    /** @type {?} */
    CalendarDatePickerComponent.prototype.layoutDom;
    /** @type {?} */
    CalendarDatePickerComponent.prototype.panelDom;
    /** @type {?} */
    CalendarDatePickerComponent.prototype.amCalendar;
    /** @type {?} */
    CalendarDatePickerComponent.prototype.datePicker;
    /** @type {?} */
    CalendarDatePickerComponent.prototype.genMonthComponent;
    /** @type {?} */
    CalendarDatePickerComponent.prototype.computeHeight;
    /** @type {?} */
    CalendarDatePickerComponent.prototype.setLayout;
    /** @type {?} */
    CalendarDatePickerComponent.prototype.setPanel;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZXBpY2tlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy16b3Jyby1hbnRkLW1vYmlsZS8iLCJzb3VyY2VzIjpbImNhbGVuZGFyL2RhdGVwaWNrZXIvZGF0ZXBpY2tlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBVSxpQkFBaUIsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVoSCxPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUU5RTtJQUtpRCx1REFBK0I7SUFDOUU7UUFBQSxZQUNFLGlCQUFPLFNBQ1I7UUFFRCxlQUFTLEdBQVcsRUFBRSxDQUFDO1FBRWYsZ0JBQVUsR0FBVyxDQUFDLENBQUM7UUFDdkIsWUFBTSxHQUFXLENBQUMsQ0FBQztRQUNuQixZQUFNLEdBQVcsS0FBSSxDQUFDLFVBQVUsQ0FBQztRQXVDUCxnQkFBVSxHQUFZLElBQUksQ0FBQztRQUMzQixnQkFBVSxHQUFZLElBQUksQ0FBQztRQUU3RCx1QkFBaUI7Ozs7UUFBRyxVQUFDLElBQTJCO1lBQzlDLElBQUksQ0FBQyxJQUFJO2dCQUFFLE9BQU87WUFDbEIsT0FBTztnQkFDTCxTQUFTLEVBQUUsSUFBSTtnQkFDZixNQUFNLEVBQUUsS0FBSSxDQUFDLEtBQUssQ0FBQyxNQUFNO2dCQUN6QixPQUFPLEVBQUUsS0FBSSxDQUFDLEtBQUssQ0FBQyxPQUFPO2dCQUMzQixXQUFXLEVBQUUsS0FBSSxDQUFDLGVBQWU7Z0JBQ2pDLFlBQVksRUFBRSxLQUFJLENBQUMsS0FBSyxDQUFDLFlBQVk7Z0JBQ3JDLEdBQUc7Ozs7Z0JBQUUsVUFBQSxHQUFHO29CQUNOLElBQUksQ0FBQyxZQUFZLEdBQUcsR0FBRyxJQUFJLElBQUksQ0FBQyxZQUFZLElBQUksU0FBUyxDQUFDO29CQUMxRCxJQUFJLENBQUMsWUFBWTs7O29C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M0IsNkNBQXlDOztJQUV6QyxnREFDc0I7O0lBQ3RCLCtDQUNxQjs7SUFrQ3JCLGlEQUE2RDs7SUFDN0QsaURBQTZEOztJQUU3RCx3REFnQkU7O0lBRUYsb0RBU0U7O0lBRUYsZ0RBY0U7O0lBRUYsK0NBRUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEhvc3RCaW5kaW5nLCBPbkluaXQsIFZpZXdFbmNhcHN1bGF0aW9uLCBJbnB1dCwgRWxlbWVudFJlZiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBEYXRlTW9kZWxzIH0gZnJvbSAnLi4vZGF0ZS9EYXRhVHlwZXMnO1xuaW1wb3J0IHsgQ2FsZW5kYXJEYXRlUGlja2VyQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vZGF0ZXBpY2tlci5iYXNlLmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ0NhbGVuZGFyRGF0ZVBpY2tlciwgbnptLWNhbGVuZGFyLWRhdGUtcGlja2VyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2RhdGVwaWNrZXIuY29tcG9uZW50Lmh0bWwnLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXG59KVxuZXhwb3J0IGNsYXNzIENhbGVuZGFyRGF0ZVBpY2tlckNvbXBvbmVudCBleHRlbmRzIENhbGVuZGFyRGF0ZVBpY2tlckJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgdHJhbnNmb3JtOiBzdHJpbmcgPSAnJztcbiAgcHJpdmF0ZSBfcGFuZWw6IGFueTtcbiAgcHJpdmF0ZSBfaW5pdERlbHRhOiBudW1iZXIgPSAwO1xuICBwcml2YXRlIF9sYXN0WTogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBfZGVsdGE6IG51bWJlciA9IHRoaXMuX2luaXREZWx0YTtcblxuICBAVmlld0NoaWxkKCdsYXlvdXQnKVxuICBsYXlvdXREb206IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ3BhbmVsJylcbiAgcGFuZWxEb206IEVsZW1lbnRSZWY7XG5cbiAgQElucHV0KClcbiAgc2V0IG9uQ2VsbENsaWNrKHZhbHVlKSB7XG4gICAgdGhpcy5wcm9wcy5vbkNlbGxDbGljayA9IHZhbHVlO1xuICB9XG4gIEBJbnB1dCgpXG4gIHNldCBlbmREYXRlKHZhbHVlKSB7XG4gICAgY29uc3Qgb2xkUHJvcHMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnByb3BzKTtcbiAgICB0aGlzLnByb3BzLmVuZERhdGUgPSB2YWx1ZTtcbiAgICB0aGlzLnJlY2VpdmVQcm9wcyhvbGRQcm9wcywgdGhpcy5wcm9wcyk7XG4gIH1cbiAgQElucHV0KClcbiAgc2V0IHN0YXJ0RGF0ZSh2YWx1ZSkge1xuICAgIGNvbnN0IG9sZFByb3BzID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5wcm9wcyk7XG4gICAgdGhpcy5wcm9wcy5zdGFydERhdGUgPSB2YWx1ZTtcbiAgICB0aGlzLnJlY2VpdmVQcm9wcyhvbGRQcm9wcywgdGhpcy5wcm9wcyk7XG4gIH1cbiAgQElucHV0KClcbiAgc2V0IHByb3BzRGF0YSh2YWx1ZSkge1xuICAgIHRoaXMucHJvcHMgPSB7XG4gICAgICAuLi50aGlzLnByb3BzLFxuICAgICAgLi4udmFsdWVcbiAgICB9O1xuICB9XG4gIEBJbnB1dCgpXG4gIHNldCBvblNlbGVjdEhhc0Rpc2FibGVEYXRlKHZhbHVlKSB7XG4gICAgdGhpcy5wcm9wcy5vblNlbGVjdEhhc0Rpc2FibGVEYXRlID0gdmFsdWU7XG4gIH1cbiAgQElucHV0KClcbiAgc2V0IG9uTGF5b3V0KHZhbHVlKSB7XG4gICAgdGhpcy5wcm9wcy5vbkxheW91dCA9IHZhbHVlO1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5hbS1jYWxlbmRhcicpIGFtQ2FsZW5kYXI6IGJvb2xlYW4gPSB0cnVlO1xuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmRhdGUtcGlja2VyJykgZGF0ZVBpY2tlcjogYm9vbGVhbiA9IHRydWU7XG5cbiAgZ2VuTW9udGhDb21wb25lbnQgPSAoZGF0YT86IERhdGVNb2RlbHMuTW9udGhEYXRhKSA9PiB7XG4gICAgaWYgKCFkYXRhKSByZXR1cm47XG4gICAgcmV0dXJuIHtcbiAgICAgIG1vbnRoRGF0YTogZGF0YSxcbiAgICAgIGxvY2FsZTogdGhpcy5wcm9wcy5sb2NhbGUsXG4gICAgICByb3dTaXplOiB0aGlzLnByb3BzLnJvd1NpemUsXG4gICAgICBvbkNlbGxDbGljazogdGhpcy5iYXNlT25DZWxsQ2xpY2ssXG4gICAgICBnZXREYXRlRXh0cmE6IHRoaXMucHJvcHMuZ2V0RGF0ZUV4dHJhLFxuICAgICAgcmVmOiBkb20gPT4ge1xuICAgICAgICBkYXRhLmNvbXBvbmVudFJlZiA9IGRvbSB8fCBkYXRhLmNvbXBvbmVudFJlZiB8fCB1bmRlZmluZWQ7XG4gICAgICAgIGRhdGEudXBkYXRlTGF5b3V0ID0gKCkgPT4ge1xuICAgICAgICAgIHRoaXMuY29tcHV0ZUhlaWdodChkYXRhLCBkb20pO1xuICAgICAgICB9O1xuICAgICAgICBkYXRhLnVwZGF0ZUxheW91dCgpO1xuICAgICAgfVxuICAgIH07XG4gIH07XG5cbiAgY29tcHV0ZUhlaWdodCA9IChkYXRhOiBEYXRlTW9kZWxzLk1vbnRoRGF0YSwgc2luZ2xlTW9udGgpID0+IHtcbiAgICBpZiAoc2luZ2xlTW9udGggJiYgc2luZ2xlTW9udGgud3JhcHBlckRpdkRPTSkge1xuICAgICAgaWYgKCFkYXRhLmhlaWdodCAmJiAhc2luZ2xlTW9udGgud3JhcHBlckRpdkRPTS5jbGllbnRIZWlnaHQpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmNvbXB1dGVIZWlnaHQoZGF0YSwgc2luZ2xlTW9udGgpLCA1MDApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBkYXRhLmhlaWdodCA9IHNpbmdsZU1vbnRoLndyYXBwZXJEaXZET00uY2xpZW50SGVpZ2h0IHx8IGRhdGEuaGVpZ2h0IHx8IDA7XG4gICAgICBkYXRhLnkgPSBzaW5nbGVNb250aC53cmFwcGVyRGl2RE9NLm9mZnNldFRvcCB8fCBkYXRhLnkgfHwgMDtcbiAgICB9XG4gIH07XG5cbiAgc2V0TGF5b3V0ID0gKGRvbTogSFRNTERpdkVsZW1lbnQpID0+IHtcbiAgICBpZiAoZG9tKSB7XG4gICAgICBjb25zdCB7IG9uTGF5b3V0IH0gPSB0aGlzLnByb3BzO1xuICAgICAgb25MYXlvdXQgJiYgb25MYXlvdXQoZG9tLmNsaWVudEhlaWdodCk7XG5cbiAgICAgIGNvbnN0IHNjcm9sbEhhbmRsZXIgPSB0aGlzLmNyZWF0ZU9uU2Nyb2xsKCk7XG4gICAgICBkb20ub25zY3JvbGwgPSBldnQgPT4ge1xuICAgICAgICBzY3JvbGxIYW5kbGVyKHtcbiAgICAgICAgICBjbGllbnQ6IGRvbS5jbGllbnRIZWlnaHQsXG4gICAgICAgICAgZnVsbDogKGV2dC5jdXJyZW50VGFyZ2V0IGFzIEhUTUxEaXZFbGVtZW50KS5jbGllbnRIZWlnaHQsXG4gICAgICAgICAgdG9wOiAoZXZ0LmN1cnJlbnRUYXJnZXQgYXMgSFRNTERpdkVsZW1lbnQpLnNjcm9sbFRvcFxuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfVxuICB9O1xuXG4gIHNldFBhbmVsID0gKGRvbTogSFRNTERpdkVsZW1lbnQpID0+IHtcbiAgICB0aGlzLl9wYW5lbCA9IGRvbTtcbiAgfTtcblxuICBvblRvdWNoU3RhcnQoZXZlbnQpIHtcbiAgICB0aGlzLl9sYXN0WSA9IGV2ZW50LnRvdWNoZXNbMF0uc2NyZWVuWSB8fCBldmVudC50b3VjaGVzWzBdLnBhZ2VZO1xuICAgIHRoaXMuX2RlbHRhID0gdGhpcy5faW5pdERlbHRhO1xuICB9XG5cbiAgb25Ub3VjaE1vdmUoZXZlbnQpIHtcbiAgICBjb25zdCBlbGUgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgIGNvbnN0IGlzUmVhY2hUb3AgPSBlbGUuc2Nyb2xsVG9wID09PSAwO1xuXG4gICAgaWYgKGlzUmVhY2hUb3ApIHtcbiAgICAgIHRoaXMuX2RlbHRhID0gKGV2ZW50LnRvdWNoZXNbMF0uc2NyZWVuWSB8fCBldmVudC50b3VjaGVzWzBdLnBhZ2VZKSAtIHRoaXMuX2xhc3RZO1xuICAgICAgaWYgKHRoaXMuX2RlbHRhID4gMCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAodGhpcy5fZGVsdGEgPiA4MCkge1xuICAgICAgICAgIHRoaXMuX2RlbHRhID0gODA7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX2RlbHRhID0gMDtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0VHJhbnNmb3JtKHRoaXMuX3BhbmVsLnN0eWxlLCBgdHJhbnNsYXRlM2QoMCwke3RoaXMuX2RlbHRhfXB4LDApYCk7XG4gICAgfVxuICB9XG5cbiAgb25Ub3VjaEVuZChldmVudCkge1xuICAgIHRoaXMub25GaW5pc2goKTtcbiAgfVxuXG4gIG9uRmluaXNoKCkge1xuICAgIGlmICh0aGlzLl9kZWx0YSA+IDQwICYmIHRoaXMuY2FuTG9hZFByZXYoKSkge1xuICAgICAgdGhpcy5nZW5Nb250aERhdGEodGhpcy5zdGF0ZS5tb250aHNbMF0uZmlyc3REYXRlLCAtMSk7XG5cbiAgICAgIHRoaXMudmlzaWJsZU1vbnRoID0gdGhpcy5zdGF0ZS5tb250aHMuc2xpY2UoMCwgdGhpcy5wcm9wcy5pbml0YWxNb250aHMpO1xuXG4gICAgICB0aGlzLnN0YXRlLm1vbnRocy5mb3JFYWNoKG0gPT4ge1xuICAgICAgICBtLnVwZGF0ZUxheW91dCAmJiBtLnVwZGF0ZUxheW91dCgpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuc2V0VHJhbnNmb3JtKHRoaXMuX3BhbmVsLnN0eWxlLCBgdHJhbnNsYXRlM2QoMCwwLDApYCk7XG4gICAgdGhpcy5zZXRUcmFuc2l0aW9uKHRoaXMuX3BhbmVsLnN0eWxlLCAnLjNzJyk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLl9wYW5lbCAmJiB0aGlzLnNldFRyYW5zaXRpb24odGhpcy5fcGFuZWwuc3R5bGUsICcnKTtcbiAgICB9LCAzMDApO1xuICB9XG5cbiAgc2V0VHJhbnNmb3JtKG5vZGVTdHlsZTogQ1NTU3R5bGVEZWNsYXJhdGlvbiwgdmFsdWU6IGFueSkge1xuICAgIHRoaXMudHJhbnNmb3JtID0gdmFsdWU7XG4gICAgbm9kZVN0eWxlLnRyYW5zZm9ybSA9IHZhbHVlO1xuICAgIG5vZGVTdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSB2YWx1ZTtcbiAgfVxuXG4gIHNldFRyYW5zaXRpb24obm9kZVN0eWxlOiBDU1NTdHlsZURlY2xhcmF0aW9uLCB2YWx1ZTogYW55KSB7XG4gICAgbm9kZVN0eWxlLnRyYW5zaXRpb24gPSB2YWx1ZTtcbiAgICBub2RlU3R5bGUud2Via2l0VHJhbnNpdGlvbiA9IHZhbHVlO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5pbml0KCk7XG4gICAgdGhpcy5zZXRMYXlvdXQodGhpcy5sYXlvdXREb20ubmF0aXZlRWxlbWVudCk7XG4gICAgdGhpcy5zZXRQYW5lbCh0aGlzLnBhbmVsRG9tLm5hdGl2ZUVsZW1lbnQpO1xuICB9XG59XG4iXX0=