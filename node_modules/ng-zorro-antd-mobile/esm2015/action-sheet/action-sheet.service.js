/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { ActionSheetComponent } from './action-sheet.component';
import { ActionSheetOptions, ShareActionSheetWithOptions } from './action-sheet-options.provider';
import { PopupService } from '../core/services/popup.service';
import * as i0 from "@angular/core";
import * as i1 from "./public-api";
import * as i2 from "@angular/cdk/overlay";
/** @type {?} */
const NORMAL = 'NORMAL';
/** @type {?} */
const SHARE = 'SHARE';
/**
 * @return {?}
 */
function noop() { }
export class ActionSheetService extends PopupService {
    /**
     * @param {?} config
     * @param {?=} options
     * @return {?}
     */
    static _initConfig(config, options = {}) {
        /** @type {?} */
        const props = new ActionSheetOptions();
        /** @type {?} */
        const optionalParams = [
            'prefixCls',
            'maskClosable',
            'cancelButtonText',
            'cancelButtonIndex',
            'destructiveButtonIndex',
            'title',
            'message',
            'className',
            'transitionName',
            'maskTransitionName',
            'options',
            'locale'
        ];
        config = Object.assign(options, config, {
            close: (/**
             * @return {?}
             */
            () => {
                if (config.maskClosable) {
                    ActionSheetService.closeWithAnimation(config.transitionName, config.maskTransitionName);
                }
            })
        });
        optionalParams.forEach((/**
         * @param {?} key
         * @return {?}
         */
        key => {
            if (config[key] !== undefined) {
                props[key] = config[key];
            }
        }));
        return props;
    }
    /**
     * @param {?} props
     * @return {?}
     */
    static _open(props) {
        setTimeout((/**
         * @return {?}
         */
        () => {
            ActionSheetService.comRef = ActionSheetService.showPopup('ActionSheetComponent', ActionSheetComponent);
            ActionSheetService.comRef.instance.option = props;
        }), 0);
    }
    /**
     * @param {?} flag
     * @param {?} config
     * @param {?} callback
     * @return {?}
     */
    static createActionSheet(flag, config, callback) {
        /** @type {?} */
        const options = flag === NORMAL ? new ActionSheetOptions() : new ShareActionSheetWithOptions();
        /** @type {?} */
        const transitionName = config.transitionName ? config.transitionName : options.transitionName;
        options.transitionName = `${transitionName}-enter ${transitionName}-enter-active`;
        /** @type {?} */
        const maskTransitionName = config.maskTransitionName ? config.maskTransitionName : options.maskTransitionName;
        options.maskTransitionName = `${maskTransitionName}-enter ${maskTransitionName}-enter-active`;
        /** @type {?} */
        const props = ActionSheetService._initConfig(config, options);
        Object.assign(props, { onPress: cb }, { flag: flag }, { maskClose: props.maskClosable ? cb : (/**
             * @return {?}
             */
            () => { }) });
        /**
         * @param {?} index
         * @param {?=} rowIndex
         * @param {?=} event
         * @return {?}
         */
        function cb(index, rowIndex = 0, event) {
            event.stopPropagation();
            /** @type {?} */
            const res = callback(index, rowIndex);
            if (res && res.then) {
                res.then((/**
                 * @return {?}
                 */
                () => {
                    ActionSheetService.closeWithAnimation(transitionName, maskTransitionName);
                }));
            }
            else {
                ActionSheetService.closeWithAnimation(transitionName, maskTransitionName);
            }
        }
        return ActionSheetService._open(props);
    }
    /**
     * @param {?} transitionName
     * @param {?} maskTransitionName
     * @return {?}
     */
    static closeWithAnimation(transitionName, maskTransitionName) {
        ActionSheetService.comRef.instance.option.transitionName = `${transitionName}-leave ${transitionName}-leave-active`;
        ActionSheetService.comRef.instance.option.maskTransitionName = `${maskTransitionName}-leave ${maskTransitionName}-leave-active`;
        setTimeout((/**
         * @return {?}
         */
        () => {
            ActionSheetService.close();
        }), 200);
    }
    /**
     * @param {?} config
     * @param {?=} callback
     * @return {?}
     */
    static showActionSheetWithOptions(config, callback = noop) {
        ActionSheetService.createActionSheet(NORMAL, config, callback);
    }
    /**
     * @param {?} config
     * @param {?=} callback
     * @return {?}
     */
    static showShareActionSheetWithOptions(config, callback = noop) {
        ActionSheetService.createActionSheet(SHARE, config, callback);
    }
    /**
     * @return {?}
     */
    static close() {
        ActionSheetService.hidePopup('ActionSheetComponent');
    }
}
ActionSheetService.compRef = null;
ActionSheetService._actionSheetCompFactory = null;
ActionSheetService.appRef = null;
ActionSheetService.comRef = null;
ActionSheetService.instance = null;
ActionSheetService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */ ActionSheetService.ngInjectableDef = i0.defineInjectable({ factory: function ActionSheetService_Factory() { return new i1.ActionSheet(i0.inject(i2.Overlay)); }, token: i1.ActionSheet, providedIn: "root" });
if (false) {
    /** @type {?} */
    ActionSheetService.compRef;
    /** @type {?} */
    ActionSheetService._actionSheetCompFactory;
    /** @type {?} */
    ActionSheetService.appRef;
    /** @type {?} */
    ActionSheetService.comRef;
    /** @type {?} */
    ActionSheetService.instance;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aW9uLXNoZWV0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy16b3Jyby1hbnRkLW1vYmlsZS8iLCJzb3VyY2VzIjpbImFjdGlvbi1zaGVldC9hY3Rpb24tc2hlZXQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBa0QsTUFBTSxlQUFlLENBQUM7QUFDM0YsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDaEUsT0FBTyxFQUVMLGtCQUFrQixFQUVsQiwyQkFBMkIsRUFDNUIsTUFBTSxpQ0FBaUMsQ0FBQztBQUN6QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7Ozs7O01BRXhELE1BQU0sR0FBRyxRQUFROztNQUNqQixLQUFLLEdBQUcsT0FBTzs7OztBQUNyQixTQUFTLElBQUksS0FBSSxDQUFDO0FBSWxCLE1BQU0sT0FBTyxrQkFBbUIsU0FBUSxZQUFZOzs7Ozs7SUFRbEQsTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUEwQixFQUFFLFVBQWtCLEVBQUU7O2NBQzNELEtBQUssR0FBdUIsSUFBSSxrQkFBa0IsRUFBRTs7Y0FDcEQsY0FBYyxHQUFhO1lBQy9CLFdBQVc7WUFDWCxjQUFjO1lBQ2Qsa0JBQWtCO1lBQ2xCLG1CQUFtQjtZQUNuQix3QkFBd0I7WUFDeEIsT0FBTztZQUNQLFNBQVM7WUFDVCxXQUFXO1lBQ1gsZ0JBQWdCO1lBQ2hCLG9CQUFvQjtZQUNwQixTQUFTO1lBQ1QsUUFBUTtTQUNUO1FBQ0QsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRTtZQUN0QyxLQUFLOzs7WUFBRSxHQUFTLEVBQUU7Z0JBQ2hCLElBQUksTUFBTSxDQUFDLFlBQVksRUFBRTtvQkFDdkIsa0JBQWtCLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FB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QWtCLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsa0JBQWtCLEdBQUcsR0FBRyxrQkFBa0IsVUFBVSxrQkFBa0IsZUFBZSxDQUFDO1FBQ2hJLFVBQVU7OztRQUFDLEdBQUcsRUFBRTtZQUNkLGtCQUFrQixDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzdCLENBQUMsR0FBRSxHQUFHLENBQUMsQ0FBQztJQUNWLENBQUM7Ozs7OztJQUVELE1BQU0sQ0FBQywwQkFBMEIsQ0FBQyxNQUE4QixFQUFFLFdBQTJCLElBQUk7UUFDL0Ysa0JBQWtCLENBQUMsaUJBQWlCLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUNqRSxDQUFDOzs7Ozs7SUFFRCxNQUFNLENBQUMsK0JBQStCLENBQUMsTUFBbUMsRUFBRSxXQUEyQixJQUFJO1FBQ3pHLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDaEUsQ0FBQzs7OztJQUVELE1BQU0sQ0FBQyxLQUFLO1FBQ1Ysa0JBQWtCLENBQUMsU0FBUyxDQUFDLHNCQUFzQixDQUFDLENBQUM7SUFDdkQsQ0FBQzs7QUF6Rk0sMEJBQU8sR0FBc0IsSUFBSSxDQUFDO0FBQ2xDLDBDQUF1QixHQUEyQyxJQUFJLENBQUM7QUFDdkUseUJBQU0sR0FBbUIsSUFBSSxDQUFDO0FBQzlCLHlCQUFNLEdBQXVDLElBQUksQ0FBQztBQUVsRCwyQkFBUSxHQUFHLElBQUksQ0FBQzs7WUFUeEIsVUFBVSxTQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COzs7OztJQUVDLDJCQUF5Qzs7SUFDekMsMkNBQThFOztJQUM5RSwwQkFBcUM7O0lBQ3JDLDBCQUF5RDs7SUFFekQsNEJBQXVCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgQ29tcG9uZW50UmVmLCBDb21wb25lbnRGYWN0b3J5LCBBcHBsaWNhdGlvblJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWN0aW9uU2hlZXRDb21wb25lbnQgfSBmcm9tICcuL2FjdGlvbi1zaGVldC5jb21wb25lbnQnO1xuaW1wb3J0IHtcbiAgQWN0aW9uQ2FsbEJhY2ssXG4gIEFjdGlvblNoZWV0T3B0aW9ucyxcbiAgQWN0aW9uU2hlZXRXaXRoT3B0aW9ucyxcbiAgU2hhcmVBY3Rpb25TaGVldFdpdGhPcHRpb25zXG59IGZyb20gJy4vYWN0aW9uLXNoZWV0LW9wdGlvbnMucHJvdmlkZXInO1xuaW1wb3J0IHsgUG9wdXBTZXJ2aWNlIH0gZnJvbSAnLi4vY29yZS9zZXJ2aWNlcy9wb3B1cC5zZXJ2aWNlJztcblxuY29uc3QgTk9STUFMID0gJ05PUk1BTCc7XG5jb25zdCBTSEFSRSA9ICdTSEFSRSc7XG5mdW5jdGlvbiBub29wKCkge31cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIEFjdGlvblNoZWV0U2VydmljZSBleHRlbmRzIFBvcHVwU2VydmljZSB7XG4gIHN0YXRpYyBjb21wUmVmOiBDb21wb25lbnRSZWY8YW55PiA9IG51bGw7XG4gIHN0YXRpYyBfYWN0aW9uU2hlZXRDb21wRmFjdG9yeTogQ29tcG9uZW50RmFjdG9yeTxBY3Rpb25TaGVldENvbXBvbmVudD4gPSBudWxsO1xuICBzdGF0aWMgYXBwUmVmOiBBcHBsaWNhdGlvblJlZiA9IG51bGw7XG4gIHN0YXRpYyBjb21SZWY6IENvbXBvbmVudFJlZjxBY3Rpb25TaGVldENvbXBvbmVudD4gPSBudWxsO1xuXG4gIHN0YXRpYyBpbnN0YW5jZSA9IG51bGw7XG5cbiAgc3RhdGljIF9pbml0Q29uZmlnKGNvbmZpZzogQWN0aW9uU2hlZXRPcHRpb25zLCBvcHRpb25zOiBPYmplY3QgPSB7fSk6IEFjdGlvblNoZWV0T3B0aW9ucyB7XG4gICAgY29uc3QgcHJvcHM6IEFjdGlvblNoZWV0T3B0aW9ucyA9IG5ldyBBY3Rpb25TaGVldE9wdGlvbnMoKTtcbiAgICBjb25zdCBvcHRpb25hbFBhcmFtczogc3RyaW5nW10gPSBbXG4gICAgICAncHJlZml4Q2xzJyxcbiAgICAgICdtYXNrQ2xvc2FibGUnLFxuICAgICAgJ2NhbmNlbEJ1dHRvblRleHQnLFxuICAgICAgJ2NhbmNlbEJ1dHRvbkluZGV4JyxcbiAgICAgICdkZXN0cnVjdGl2ZUJ1dHRvbkluZGV4JyxcbiAgICAgICd0aXRsZScsXG4gICAgICAnbWVzc2FnZScsXG4gICAgICAnY2xhc3NOYW1lJyxcbiAgICAgICd0cmFuc2l0aW9uTmFtZScsXG4gICAgICAnbWFza1RyYW5zaXRpb25OYW1lJyxcbiAgICAgICdvcHRpb25zJyxcbiAgICAgICdsb2NhbGUnXG4gICAgXTtcbiAgICBjb25maWcgPSBPYmplY3QuYXNzaWduKG9wdGlvbnMsIGNvbmZpZywge1xuICAgICAgY2xvc2U6ICgpOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKGNvbmZpZy5tYXNrQ2xvc2FibGUpIHtcbiAgICAgICAgICBBY3Rpb25TaGVldFNlcnZpY2UuY2xvc2VXaXRoQW5pbWF0aW9uKGNvbmZpZy50cmFuc2l0aW9uTmFtZSwgY29uZmlnLm1hc2tUcmFuc2l0aW9uTmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICBvcHRpb25hbFBhcmFtcy5mb3JFYWNoKGtleSA9PiB7XG4gICAgICBpZiAoY29uZmlnW2tleV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBwcm9wc1trZXldID0gY29uZmlnW2tleV07XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHByb3BzO1xuICB9XG5cbiAgc3RhdGljIF9vcGVuKHByb3BzOiBBY3Rpb25TaGVldE9wdGlvbnMpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIEFjdGlvblNoZWV0U2VydmljZS5jb21SZWYgPSAgQWN0aW9uU2hlZXRTZXJ2aWNlLnNob3dQb3B1cCgnQWN0aW9uU2hlZXRDb21wb25lbnQnLCBBY3Rpb25TaGVldENvbXBvbmVudCk7XG4gICAgICBBY3Rpb25TaGVldFNlcnZpY2UuY29tUmVmLmluc3RhbmNlLm9wdGlvbiA9IHByb3BzO1xuICAgIH0sIDApO1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZUFjdGlvblNoZWV0KFxuICAgIGZsYWc6IHN0cmluZyxcbiAgICBjb25maWc6IEFjdGlvblNoZWV0V2l0aE9wdGlvbnMgfCBTaGFyZUFjdGlvblNoZWV0V2l0aE9wdGlvbnMsXG4gICAgY2FsbGJhY2s6IEFjdGlvbkNhbGxCYWNrXG4gICkge1xuICAgIGNvbnN0IG9wdGlvbnMgPSBmbGFnID09PSBOT1JNQUwgPyBuZXcgQWN0aW9uU2hlZXRPcHRpb25zKCkgOiBuZXcgU2hhcmVBY3Rpb25TaGVldFdpdGhPcHRpb25zKCk7XG4gICAgY29uc3QgdHJhbnNpdGlvbk5hbWUgPSBjb25maWcudHJhbnNpdGlvbk5hbWUgPyBjb25maWcudHJhbnNpdGlvbk5hbWUgOiBvcHRpb25zLnRyYW5zaXRpb25OYW1lO1xuICAgIG9wdGlvbnMudHJhbnNpdGlvbk5hbWUgPSBgJHt0cmFuc2l0aW9uTmFtZX0tZW50ZXIgJHt0cmFuc2l0aW9uTmFtZX0tZW50ZXItYWN0aXZlYDtcbiAgICBjb25zdCBtYXNrVHJhbnNpdGlvbk5hbWUgPSBjb25maWcubWFza1RyYW5zaXRpb25OYW1lID8gY29uZmlnLm1hc2tUcmFuc2l0aW9uTmFtZSA6IG9wdGlvbnMubWFza1RyYW5zaXRpb25OYW1lO1xuICAgIG9wdGlvbnMubWFza1RyYW5zaXRpb25OYW1lID0gYCR7bWFza1RyYW5zaXRpb25OYW1lfS1lbnRlciAke21hc2tUcmFuc2l0aW9uTmFtZX0tZW50ZXItYWN0aXZlYDtcbiAgICBjb25zdCBwcm9wcyA9IEFjdGlvblNoZWV0U2VydmljZS5faW5pdENvbmZpZyhjb25maWcsIG9wdGlvbnMpO1xuICAgIE9iamVjdC5hc3NpZ24ocHJvcHMsIHsgb25QcmVzczogY2IgfSwgeyBmbGFnOiBmbGFnIH0sIHsgbWFza0Nsb3NlOiBwcm9wcy5tYXNrQ2xvc2FibGUgPyBjYiA6ICgpID0+IHt9fSk7XG4gICAgZnVuY3Rpb24gY2IoaW5kZXg6IGFueSwgcm93SW5kZXggPSAwLCBldmVudCkge1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBjb25zdCByZXMgPSBjYWxsYmFjayhpbmRleCwgcm93SW5kZXgpO1xuICAgICAgaWYgKHJlcyAmJiByZXMudGhlbikge1xuICAgICAgICByZXMudGhlbigoKSA9PiB7XG4gICAgICAgICAgQWN0aW9uU2hlZXRTZXJ2aWNlLmNsb3NlV2l0aEFuaW1hdGlvbih0cmFuc2l0aW9uTmFtZSwgbWFza1RyYW5zaXRpb25OYW1lKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBBY3Rpb25TaGVldFNlcnZpY2UuY2xvc2VXaXRoQW5pbWF0aW9uKHRyYW5zaXRpb25OYW1lLCBtYXNrVHJhbnNpdGlvbk5hbWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gQWN0aW9uU2hlZXRTZXJ2aWNlLl9vcGVuKHByb3BzKTtcbiAgfVxuXG4gIHN0YXRpYyBjbG9zZVdpdGhBbmltYXRpb24odHJhbnNpdGlvbk5hbWUsIG1hc2tUcmFuc2l0aW9uTmFtZSkge1xuICAgIEFjdGlvblNoZWV0U2VydmljZS5jb21SZWYuaW5zdGFuY2Uub3B0aW9uLnRyYW5zaXRpb25OYW1lID0gYCR7dHJhbnNpdGlvbk5hbWV9LWxlYXZlICR7dHJhbnNpdGlvbk5hbWV9LWxlYXZlLWFjdGl2ZWA7XG4gICAgQWN0aW9uU2hlZXRTZXJ2aWNlLmNvbVJlZi5pbnN0YW5jZS5vcHRpb24ubWFza1RyYW5zaXRpb25OYW1lID0gYCR7bWFza1RyYW5zaXRpb25OYW1lfS1sZWF2ZSAke21hc2tUcmFuc2l0aW9uTmFtZX0tbGVhdmUtYWN0aXZlYDtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIEFjdGlvblNoZWV0U2VydmljZS5jbG9zZSgpO1xuICAgIH0sIDIwMCk7XG4gIH1cblxuICBzdGF0aWMgc2hvd0FjdGlvblNoZWV0V2l0aE9wdGlvbnMoY29uZmlnOiBBY3Rpb25TaGVldFdpdGhPcHRpb25zLCBjYWxsYmFjazogQWN0aW9uQ2FsbEJhY2sgPSBub29wKSB7XG4gICAgQWN0aW9uU2hlZXRTZXJ2aWNlLmNyZWF0ZUFjdGlvblNoZWV0KE5PUk1BTCwgY29uZmlnLCBjYWxsYmFjayk7XG4gIH1cblxuICBzdGF0aWMgc2hvd1NoYXJlQWN0aW9uU2hlZXRXaXRoT3B0aW9ucyhjb25maWc6IFNoYXJlQWN0aW9uU2hlZXRXaXRoT3B0aW9ucywgY2FsbGJhY2s6IEFjdGlvbkNhbGxCYWNrID0gbm9vcCkge1xuICAgIEFjdGlvblNoZWV0U2VydmljZS5jcmVhdGVBY3Rpb25TaGVldChTSEFSRSwgY29uZmlnLCBjYWxsYmFjayk7XG4gIH1cblxuICBzdGF0aWMgY2xvc2UoKSB7XG4gICAgQWN0aW9uU2hlZXRTZXJ2aWNlLmhpZGVQb3B1cCgnQWN0aW9uU2hlZXRDb21wb25lbnQnKTtcbiAgfVxufVxuIl19